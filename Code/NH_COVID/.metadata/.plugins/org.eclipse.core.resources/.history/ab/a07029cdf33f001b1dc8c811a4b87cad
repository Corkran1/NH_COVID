/**
* Name: ImmuneResponse
* Model to test the immune response equation
* Author: jpablo91
* Tags: 
*/


model ImmuneResponse

global {
	init {
		create predefined_ODE_SIR_agent number: 1;
	}
	
	reflex EndSim when: cycle = 150{
		do pause;
	}
}

//Species which represent the Ordinary Differential Equations System 
species predefined_ODE_SIR_agent {
	//Variable to represent the discrete time for integration
	float t;
 	//Max Effect
   	float N <- 0.60;
   	//Immune response
	float I <- 0.01; 
	//Number of susceptible
	float S <- N - I; 
	
  	float beta <- 0.4; //Rate of rise
   	float gamma <- 0.001; //Rate of decay
   		
   	float h <- 0.1;
   	string mm <- "Euler";

	// Parameters must follow exact order S, I, R, t  and N,beta,gamma	
	equation eqSIR{ 
    diff(S,t) = (- beta * S * I / N);
    diff(I,t) = (beta * S * I / N) - (gamma * I);
//    diff(R,t) = (gamma * I);
    }

	reflex solving {
		solve eqSIR method: mm step_size:h ;
	}
	
	reflex Revaccination{
		if(cycle = 21){
			N <- 0.9;
			S <- N -I;
		}
		if(cycle = 110){
			gamma <- 0.1;
		}
	}
}


experiment mysimulation type: gui {
	output {	
		display display_charts {
			species predefined_ODE_SIR_agent;
			chart 'SIR_agent' type: series background: #white {
//				data "S" value: first(predefined_ODE_SIR_agent).S color: #green;
				data "I" value: first(predefined_ODE_SIR_agent).I color: #red;
//				data "R" value: first(predefined_ODE_SIR_agent).R color: #blue;
			}
		}
	}
}